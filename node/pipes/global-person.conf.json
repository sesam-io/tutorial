{
  "_id": "global-person",
  "type": "pipe",
  "source": {
    "type": "merge",
    "datasets": ["crm-person cp", "hr-person hr", "erp-person ep", "salesforce-userprofile su"],
    "equality": [
      ["eq", "cp.crm-person:SSN", "hr.hr-person:SSN"],
      ["eq", "ep.erp-person:SSN", "hr.hr-person:SSN"],
      ["eq", "ep.erp-person:Username", "su.salesforce-userprofile:Username"]
    ],
    "identity": "first",
    "version": 2
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["comment", "Lesson 3", "this adds 'fullname' field from erp-person"],
        ["merge",
          ["apply", "nameFixer", "_S.erp-person:name"]
        ],
        ["remove", "erp-person:name"],
        ["comment", "Lesson 4", "Adds more global properties based off of all the different data sources."],
        ["add", "zipcode",
          ["coalesce",
            ["list", "_S.hr-person:ZipCode", "_S.erp-person:ZipCode", "_S.crm-person:PostalCode"]
          ]
        ],
        ["add", "email",
          ["coalesce", "_S.EmailAddress"]
        ],
        ["add", "firstname",
          ["coalesce",
            ["list", "_S.crm-person:Firstname", "_T.erp-person:Firstname", "_S.hr-person:GivenName"]
          ]
        ],
        ["add", "lastname",
          ["coalesce",
            ["list", "_S.crm-person:LastName", "_T.erp-person:Lastname", "_S.hr-person:Surname"]
          ]
        ],
        ["add", "fullname",
          ["coalesce",
            ["list", "_T.global-person:fullname",
              ["concat", "_T.global-person:firstname", " ", "_T.global-person:lastname"]
            ]
          ]
        ]
      ],
      "nameFixer": [
        ["comment", "Lesson 3"],
        ["copy", "*"],
        ["add", "fullname",
          ["concat", "_S.erp-person:Firstname", " ", "_S.erp-person:MiddleInitial", " ", "_S.erp-person:Lastname"]
        ]
      ]
    }
  },
  "metadata": {
    "global": true
  }
}
