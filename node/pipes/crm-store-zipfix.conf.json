{
  "_id": "crm-store-zipfix",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "crm-store"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "*", "crm-store:StoreZip"],
        ["comment", "this code goes through and checks if the zipcode has been wrongly stripped of a leading zero, if that is the case, then it adds it back"],
        ["comment", "alternative 1"],
        ["comment",
          ["add", "StoreZip",
            ["if",
              ["is-not-null", "_S.crm-store:StoreZip"],
              ["if",
                ["eq", 3,
                  ["length",
                    ["string", "_S.StoreZip"]
                  ]
                ],
                ["concat", "0",
                  ["string", "_S.StoreZip"]
                ],
                ["string", "_S.StoreZip"]
              ]
            ]
          ]
        ],
        ["comment", "alternative 2"],
        ["merge",
          ["apply", "iterator",
            ["string", "_S.crm-store:StoreZip"]
          ]
        ]
      ],
      "iterator": [
        ["if",
          ["eq", 4,
            ["length", "_S."]
          ],
          ["add", "StoreZip", "_S."],
          ["merge",
            ["apply", "iterator",
              ["concat", "0", "_S."]
            ]
          ]
        ]
      ]
    }
  }
}
